import{_ as Q}from"./BS7-Nf-d.js";import{u as W}from"./Dqy43P0_.js";import{_ as E,x as v,c as s,o as t,a,t as i,F as D,q as F,s as k,p as X,k as o,y as Y,g as Z,r,j as ee,b,z as L,w as y,l as O,A as ne,m as U,v as te,d as x}from"./BQaydpjH.js";import oe from"./DU6ONrhe.js";import{u as se}from"./B4oYvPNv.js";const le={class:"song-body"},ae={key:0,class:"verse"},ue={class:"part-label"},re={class:"content"},ie={key:1,class:"chorus"},ce={key:0,class:"content"},de={__name:"SongDisplay",props:{song:{type:Object,required:!0,default:()=>({number:0,title:"",body:[]})}},setup(S){const d=W(),$=v(()=>`font-size-${d.fontSize}`),w=p=>p?d.showChords?p:p.replace(/\[.*?\]/g,""):"";return(p,N)=>(t(),s("div",{class:X(["song-container",[o($),{"hide-chords":!o(d).showChords}]])},[a("h2",null,i(S.song.number)+". "+i(S.song.title),1),a("ul",le,[(t(!0),s(D,null,F(S.song.body,(u,V)=>(t(),s("li",{key:V,class:"song-part"},[u.type==="verse"?(t(),s("div",ae,[a("span",ue,i(u.id+1),1),a("pre",re,i(w(u.content)),1)])):u.type==="chorus"?(t(),s("div",ie,[N[0]||(N[0]=a("span",{class:"part-label"},"Припев",-1)),u.content?(t(),s("pre",ce,i(w(u.content)),1)):k("",!0)])):k("",!0)]))),128))])],2))}},ve=E(de,[["__scopeId","data-v-af332a53"]]),pe={key:0},me={key:1},_e={class:"nav"},ge={class:"collections-section"},fe={key:0,class:"current-collections"},be={class:"nav"},ye=["value"],ke={key:2},Ce={__name:"[number]",setup(S){const d=Y(),$=Z(),{getSong:w,getSongNumbers:p,createCollection:N,getCollectionsForSong:u,addSongToCollection:V,getAvailableCollections:I,removeSongFromCollection:P}=se(),m=r(null),z=r(!0),T=r(!1),B=r([]),_=r([]),c=r(""),g=r(""),C=r([]),h=r(-1);ee(async()=>{const e=parseInt(d.params.number);if(C.value=await p(),m.value=await w(e),h.value=C.value.indexOf(e),!m.value){z.value=!1;return}_.value=await u(e),B.value=await I(e),z.value=!1});const M=v(()=>h.value>0),R=v(()=>h.value<C.value.length-1),j=v(()=>M.value?C.value[h.value-1]:null),q=v(()=>R.value?C.value[h.value+1]:null),A=e=>{$.push(`/song/${e}`)},G=async()=>{if(c.value===""){if(!g.value.trim())return;c.value=await N(g.value)}await V(c.value,m.value.number),_.value=await u(m.value.number),c.value="",g.value=""},H=async e=>{if(confirm("Удалить песню из этой подборки?"))try{await P(Number(e),Number(d.params.number)),_.value=_.value.filter(n=>n.id!==e),B.value=await I(d.params.number)}catch(n){console.error("Ошибка удаления:",n),alert("Не удалось удалить песню")}};return v(e=>T.value&&/\{/.test(e)),v(e=>(T.value?(e=e.replace(/\{_/g,"<span class='chord'>"),e=e.replace(/\{/g,"<span class='chord chord-up'>"),e=e.replace(/\}/g,"</span>")):e=e.replace(/\{[^\}]+\}/g,""),e=e.replace(/([^>])\n/g,"$1<br/>"),e)),(e,n)=>{const f=Q,J=ve,K=oe;return t(),s("div",null,[o(z)?(t(),s("div",pe,"Загрузка...")):o(m)?(t(),s("div",me,[a("div",_e,[o(M)?(t(),L(f,{key:0,onClick:n[0]||(n[0]=l=>A(o(j))),class:"nav-button"},{default:y(()=>[x(" ← Предыдущая ("+i(o(j))+") ",1)]),_:1})):k("",!0),o(R)?(t(),L(f,{key:1,onClick:n[1]||(n[1]=l=>A(o(q))),class:"nav-button"},{default:y(()=>[x(" Следующая ("+i(o(q))+") → ",1)]),_:1})):k("",!0)]),b(J,{song:o(m)},null,8,["song"]),a("div",ge,[o(_).length>0?(t(),s("div",fe,[n[5]||(n[5]=a("h3",null,"Входит в подборки:",-1)),a("ul",null,[(t(!0),s(D,null,F(o(_),l=>(t(),s("li",{key:l.id,class:"nav"},[b(f,{to:`/collections/${l.id}`},{default:y(()=>[x(i(l.name),1)]),_:2},1032,["to"]),b(f,{onClick:he=>H(l.id),class:"remove-btn"},{default:y(()=>n[4]||(n[4]=[x("Х")])),_:2},1032,["onClick"])]))),128))])])):k("",!0),n[7]||(n[7]=a("h3",null,"Добавить в подборку",-1)),a("nav",be,[O(a("select",{"onUpdate:modelValue":n[2]||(n[2]=l=>U(c)?c.value=l:null)},[n[6]||(n[6]=a("option",{value:""},"Новая подборка",-1)),(t(!0),s(D,null,F(o(B),l=>(t(),s("option",{key:l.id,value:l.id},i(l.name),9,ye))),128))],512),[[ne,o(c)]]),o(c)===""?O((t(),s("input",{key:0,"onUpdate:modelValue":n[3]||(n[3]=l=>U(g)?g.value=l:null),placeholder:"Название подборки"},null,512)),[[te,o(g)]]):k("",!0),b(f,{onClick:G},{default:y(()=>[b(K,{name:"mingcute:add-fill",color:"black"})]),_:1})])])])):(t(),s("div",ke,[n[9]||(n[9]=a("p",null,"Песня не найдена",-1)),b(f,{to:"/"},{default:y(()=>n[8]||(n[8]=[x("Вернуться на главную")])),_:1})]))])}}},Ve=E(Ce,[["__scopeId","data-v-1f141ebd"]]);export{Ve as default};
